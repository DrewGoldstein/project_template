---
title: "Project title"
author: "by Team-Name: User1, User2, User3, User4 & User5"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-lib, include = FALSE}
library(tidyverse)
library(tidyr)
# Add any other libraries here}
```


```{r load-data, include=FALSE}
#Loading data

data <- read.csv("data/crime/communitiesUnnormalized.txt", header = FALSE, na.string = "?")
  
names_lines <- read_lines("data/crime/names.names")
  
  
attribute_lines <- grep("^@attribute", names_lines, value = TRUE)
attribute_lines <- gsub("@attribute ", "", attribute_lines)
attribute_lines <- gsub(" .*", "", attribute_lines)

colnames(data) <- c(attribute_lines)

column_names <- colnames(data)
```


## Research Question

Which factors influence more on the crime level of a city in the United States? (Clearly we should refine this statement)





## Data

Briefly describe your dataset here - include a description of the key variables you will be investigating. 
Include a citation for your data. 
See http://libraryguides.vu.edu.au/c.php?g=386501&p=4347840 for guidance on proper citation for datasets. 
If you got your data off the web, make sure to state the retrieval date.






## Findings

## Economic variables

In order to find a suitable economic variable to model the violence in a given city, we'll start by taking a look at the income per capita.

Let's equally split the variable perCapInc into four categories representing the level of wealth of each city, and let's visualize the relation of these categories with the ViolentPerPop:

```{r, echo = TRUE, warning = FALSE}
data <- data %>%
  mutate(
    wealth_category = cut(
      perCapInc,
      breaks = quantile(perCapInc, probs = seq(0, 1, 0.25), na.rm = TRUE),
      include.lowest = TRUE,
      labels = c("Low wealth", "Middle-Low wealth", "Middle-High Wealth", "High Wealth")
    )
  )

ggplot(data, aes(x = wealth_category, y = violentPerPop, fill = wealth_category)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Violent Crimes per each wealth category",
    x = "Wealth category",
    y = "Violent crimes per 100K"
  ) +
  theme_minimal()
```

We spot a clear relation between the economic level of a city and the level of violent, that is, as the level of wealth increases, the level of violent decreases.

However, recall that the income per capita is mathematically defined as follows:
$$
perCapInc = \frac{\text{Total Income}}{Population}
$$
That means, if the total income is **large enough**, the perCapInc variable will grow independently of how equally distributed are the resources within the population. This encourages us to include some other variable that better measures this distribution.

Let's take a look at the pctPoverty variable (percentage of people under poverty). It is well-known that as the population under poverty increases in a country, then does the level of crime as well.

Nevertheless, something interesting happens when we observe the relation between the poverty and crime for each of the wealth categories:

```{r, echo = TRUE, warning = FALSE}
ggplot(data, aes(x = pctPoverty, y = violentPerPop)) +
  geom_point(alpha = 0.6, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  facet_wrap(~ wealth_category, scales = "free") +
  labs(
    title = "Crimes vs Percentage of People Under Poverty",
    x = "Percentage Under Poverty",
    y = "Violent Crimes per 100K"
  ) +
  theme_minimal()

data %>%
  group_by(wealth_category) %>%
  summarise(
  coef = cor(pctPoverty, violentPerPop, use = "complete.obs", method = "pearson"))

```

```{r, echo=TRUE, warning=FALSE}

family_statistics <- data %>%
  select(medFamIncome, pct2Par, `pctWorkMom-6`, violentPerPop) %>%
  drop_na() %>% # Dropping all NAs
  rename(
    Median_Family_Income = medFamIncome,
    Families_with_two_parents = pct2Par,
    Working_moms = `pctWorkMom-6`
  ) %>% # Renaming variables
  mutate(
    Median_Family_Income_Levels = cut(
      Median_Family_Income,
      breaks = quantile(Median_Family_Income, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
      labels = c("Low", "Medium", "High"),
      include.lowest = TRUE
    ),
    Number_of_Two_Parent_Families = cut(
      Families_with_two_parents,
      breaks = quantile(Families_with_two_parents, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
      labels = c("Low", "Medium", "High"),
      include.lowest = TRUE
    ),
    Number_of_Working_Moms = cut(
      Working_moms,
      breaks = quantile(Working_moms, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
      labels = c("Low", "Medium", "High"),
      include.lowest = TRUE
      )
) # Mutating to create three levels (Low, Medium, High) for income, percentage of two parent families an working moms
```

```{r, echo=TRUE, warning=FALSE}
family_statistics_summary <- family_statistics %>%
  summarise(across(where(is.numeric),
      list(
        mean = ~mean(.x, na.rm = TRUE),
        median = ~median(.x, na.rm = TRUE),
        sd = ~sd(.x, na.rm = TRUE),
        min = ~min(.x, na.rm = TRUE),
        max = ~max(.x, na.rm = TRUE)
      ),
      .names = "{.col}_{.fn}"))
print(family_statistics_summary) # Calculating simple summary statistics
```

```{r, echo=TRUE, warning=FALSE}
family_statistics_long <- family_statistics %>%
  pivot_longer(
    cols = c(Median_Family_Income_Levels, Number_of_Two_Parent_Families, Number_of_Working_Moms),
    names_to = "Category",
    values_to = "Level"
  ) # Combining Levels (Low, Medium, High) and Category (Income_Levels, Two_Parent_Families, Working_Moms)

family_statistics_long <- family_statistics_long %>%
  mutate(
    Level = factor(Level, levels = c("Low", "Medium", "High"))
  ) # Defining Level

family_statistics_long <- family_statistics_long %>%
  mutate(
    Category = str_replace_all(Category, "_", " ")
    ) # Deleting underscore from variable names
```

```{r, echo=TRUE, warning=FALSE}
ggplot(family_statistics_long, 
       aes(x = Level, 
           y = violentPerPop, 
           fill = Level)) +
  geom_boxplot() +
  facet_wrap(~ Category, scales = "free") +
  labs(
    title = "Boxplot of Violent Crimes Per Population by Socioeconomic Levels of Families",
    subtitle = "Grouped by Median Family Income, Number of Two Parent Families and Number of Working moms",
    x = "Socioeconomic Levels",
    y = "Number of violent Crimes Per Population"
  ) +
  theme_minimal() +
  theme_bw() +
  theme(
    plot.subtitle = element_text(size = 10) 
  )# Box plot showing the relationship between familial status and violent crimes
```

```{r, echo=TRUE, warning=FALSE}
ggplot(data = family_statistics_long, 
       mapping = aes(
         x = violentPerPop,
         fill = Level
         )) +
  geom_histogram(
    bins = 50,
    alpha = 1 
    ) +
  labs(
    x = "Number of Crimes",
     y = "Number of Violent Crimes Per Population",
     title = "Histogram of Socioeconomic Level and Violent Crimes Per Population",
    subtitle = "Grouped by Median Family Income, Number of Two Parent Families and Number of Working moms"
  ) +
  facet_wrap(~ Category,
             ncol = 3) +
  theme(
    plot.subtitle = element_text(size = 10) 
  ) # Histogram showing the relationship between family status and violent crimes
```

## References

List any references here. You should, at a minimum, list your data source.


